<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Refer√™ncias | 4S Store</title>
<link rel="icon" href="favicon.ico">

<!-- Google Fonts e Font Awesome -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:800&family=Gravitas+One&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:Arial,sans-serif;
    min-height:100vh;
    overflow-x:hidden;
    color:#fff;
    padding-top:90px;
    background: url('https://loki.ragnarevival.com/themes/default/img/bg-img/welcome-bg.webp') no-repeat center center fixed;
    background-size: cover;
}

/* HEADER TRANSPARENTE CENTRALIZADO */
header{
    position:fixed;
    top:0;
    width:100%;
    padding:12px 60px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    background: transparent;
    z-index:999;
    transition: top 0.4s;
}

/* BOT√ÉO VOLTAR FIXO NO CANTO */
header .back-button{
    position:absolute;
    top:12px;
    left:20px;
    padding:12px 24px;
    background:linear-gradient(145deg,#0d6efd,#004bbd);
    color:#fff;
    border-radius:25px;
    font-weight:bold;
    text-decoration:none;
    box-shadow:0 0 12px rgba(0,102,255,.7);
    transition:.3s;
}
header .back-button:hover{
    transform:scale(1.05);
    box-shadow:0 0 28px rgba(0,102,255,.9);
}

/* TITULO CENTRALIZADO */
header h1{
    font-family:'Montserrat',sans-serif;
    font-size:3rem;
    color:#0d6efd;
    text-shadow:0 0 12px rgba(0,102,255,.5);
}
header p{
    font-size:1.2rem;
    color:#eaf6ff;
    text-shadow:0 0 6px rgba(0,153,255,.4);
}

/* FORMUL√ÅRIO REFER√äNCIAS */
.reference-form{
    max-width:540px;
    margin:140px auto 60px;
    background: linear-gradient(145deg,#111,#222);
    padding:30px 25px;
    border-radius:15px;
    box-shadow:0 0 25px rgba(0,102,255,.2), 0 0 35px rgba(75,0,210,.2);
    transition:all 0.3s ease;
}
.reference-form:hover{
    box-shadow:0 0 35px rgba(0,102,255,.3), 0 0 45px rgba(75,0,210,.2);
}
.reference-form h2{
    text-align:center;
    margin-bottom:25px;
    color:#0d6efd;
    font-size:1.8rem;
    letter-spacing:1px;
}
.reference-form input,
.reference-form textarea,
.reference-form button{
    width:100%;
    padding:14px;
    margin:10px 0;
    border-radius:12px;
    border:none;
    font-size:1.05rem;
}
.reference-form input,
.reference-form textarea{
    background:#262626;
    color:#fff;
    box-shadow: inset 0 0 10px rgba(0,0,0,.5);
    transition: all 0.3s ease;
}
.reference-form input:focus,
.reference-form textarea:focus{
    outline:none;
    box-shadow: inset 0 0 12px rgba(0,102,255,.7);
}
.reference-form button{
    background: linear-gradient(135deg,#0d6efd,#004bbd);
    color:#fff;
    font-weight:bold;
    cursor:pointer;
    transition:.3s;
    box-shadow:0 0 12px rgba(0,102,255,.5);
}
.reference-form button:hover{
    transform: scale(1.05);
    box-shadow:0 0 28px rgba(0,102,255,.8);
}

/* MENSAGENS DE SUCESSO E ERRO */
#successMessage{
    margin-top:15px;
    color:#00ff99;
    font-weight:bold;
    text-align:center;
    text-shadow:0 0 6px rgba(0,255,153,.7);
}
#errorMessage{
    margin-top:15px;
    color:#ff5555;
    font-weight:bold;
    text-align:center;
    text-shadow:0 0 8px rgba(255,85,85,.7);
    animation: glowError 1.5s infinite alternate;
}
@keyframes glowError{
    from { text-shadow:0 0 6px rgba(255,85,85,.7); }
    to { text-shadow:0 0 14px rgba(255,85,85,1); }
}

/* CARDS REFER√äNCIAS */
.carousel{display:flex; justify-content:center; margin-bottom:60px;}
.carousel-inner{display:flex; justify-content:center;}

.reference-card{
    background:#1f1f1f;
    padding:20px;
    border-radius:15px;
    box-shadow:0 0 20px rgba(0,102,255,.15),0 0 35px rgba(0,102,255,.1);
    margin:10px;
    width:540px;
    min-height:200px;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    position:relative;
    transition:all 0.4s ease;
    border:1px solid rgba(0,102,255,0.3);
    overflow:hidden;
}

.reference-card:hover{
    transform: translateY(-5px);
    box-shadow:0 0 35px rgba(0,102,255,.5),0 0 50px rgba(0,102,255,.3);
}

.reference-text{
    display:flex;
    align-items:flex-start;
    gap:12px;
    flex-wrap:nowrap;
}

.reference-text img.icon{
    width:50px;
    height:50px;
    flex-shrink:0;
    border-radius:50%;
    object-fit:cover;
}

.reference-text div{
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    overflow:hidden;
}

.reference-text h4{
    font-size:1.25rem;
    color:#fff;
    font-weight:700;
    text-overflow:ellipsis;
    white-space:nowrap;
    overflow:hidden;
    margin-bottom:2px;
}

.reference-text h3{
    font-size:1.1rem;
    color:#0d6efd;
    font-weight:600;
    white-space:nowrap;
    text-overflow:ellipsis;
    overflow:hidden;
    margin-bottom:5px;
}

.reference-text p{
    font-size:1rem;
    color:#ccc;
    line-height:1.4;
    max-height:100px;
    overflow-y:auto;
    white-space:pre-wrap;
    word-wrap:break-word;
    scrollbar-width: thin;
    scrollbar-color: #0d6efd rgba(30,30,30,0.5);
}
.reference-text p::-webkit-scrollbar{
    width:8px;
}
.reference-text p::-webkit-scrollbar-track{
    background: rgba(30,30,30,0.5);
    border-radius:4px;
}
.reference-text p::-webkit-scrollbar-thumb{
    background-color:#0d6efd;
    border-radius:4px;
}

/* NEXT BUTTON */
.next-button{
    position:absolute;
    top:10px;
    right:20px;
    background: linear-gradient(145deg,#0d6efd,#004bbd);
    color:#fff;
    padding:10px 22px;
    border:none;
    border-radius:15px;
    font-weight:bold;
    cursor:pointer;
    transition:.3s;
    box-shadow:0 0 15px rgba(0,102,255,.5);
}
.next-button:hover{
    background-color:#4b00d2;
    transform: scale(1.08);
    box-shadow:0 0 35px rgba(0,102,255,.7);
}

/* WHATSAPP FLUTUANTE */
.whatsapp-button{
    position:fixed;
    bottom:20px;
    right:20px;
    background:linear-gradient(145deg,#0d6efd,#004bbd);
    color:#fff;
    padding:12px 18px;
    border-radius:12px;
    font-weight:bold;
    display:flex;
    align-items:center;
    gap:10px;
    box-shadow:0 0 18px rgba(0,102,255,.9);
    cursor:pointer;
    z-index:9999;
    transition:.3s;
}
.whatsapp-button:hover{
    transform:scale(1.08);
    box-shadow:0 0 35px rgba(0,102,255,1);
}
.whatsapp-widget{
    position:fixed;
    bottom:80px;
    right:20px;
    width:280px;
    background:linear-gradient(145deg,#07161f,#02080c);
    color:#fff;
    border-radius:12px;
    box-shadow:0 0 25px rgba(0,102,255,.6);
    display:none;
    overflow:hidden;
    z-index:9999;
}
.whatsapp-header{
    background:linear-gradient(145deg,#0d6efd,#004bbd);
    color:#fff;
    padding:12px 15px;
    display:flex;
    justify-content:space-between;
    font-weight:bold;
    box-shadow:0 0 12px rgba(0,102,255,.5);
}
.whatsapp-body{
    padding:18px;
    text-align:center;
}
.whatsapp-start{
    display:inline-block;
    background:linear-gradient(145deg,#0d6efd,#004bbd);
    color:#fff;
    padding:10px 16px;
    border-radius:8px;
    margin-top:12px;
    font-weight:bold;
    text-decoration:none;
    box-shadow:0 0 14px rgba(0,102,255,.7);
}

/* FOOTER */
footer{
    text-align:center;
    padding:30px 15px;
    background:#111;
    font-size:1.05rem;
}
footer a{
    color:#0d6efd;
    text-decoration:none;
    font-weight:bold;
}
footer a:hover{text-decoration:underline;}

/* CONTADOR DE REFER√äNCIAS */
#totalReferencesCounter{
    position:fixed;
    top:20px;
    right:20px;
    background: linear-gradient(135deg,#0d6efd,#004bbd);
    padding:12px 18px;
    font-weight:bold;
    color:#fff;
    border-radius:20px;
    font-family:'Gravitas One', cursive;
    font-size:1.2rem;
    text-align:center;
    box-shadow:0 0 12px rgba(13,110,253,0.7), 0 0 20px rgba(0,102,255,0.5);
    transition: transform 0.3s, box-shadow 0.3s;
    z-index:9999;
    white-space:nowrap;
    animation: pulseCounter 2s infinite alternate;
}
#totalReferencesCounter:hover{
    transform:scale(1.05);
    box-shadow:0 0 25px rgba(13,110,253,1), 0 0 35px rgba(0,102,255,0.8);
}
@keyframes pulseCounter {
    0% { box-shadow: 0 0 12px rgba(13,110,253,0.7), 0 0 20px rgba(0,102,255,0.5); }
    50% { box-shadow: 0 0 18px rgba(13,110,253,1), 0 0 28px rgba(0,102,255,0.7); }
    100% { box-shadow: 0 0 12px rgba(13,110,253,0.7), 0 0 20px rgba(0,102,255,0.5); }
}

/* RESPONSIVIDADE TABLET E CELULAR */
@media (max-width: 1024px){
    header{padding:12px 30px;}
    header h1{font-size:2.5rem;}
    .reference-form{margin:120px 20px 60px; max-width:480px; padding:25px;}
    .reference-card{width:420px; padding:18px;}
}
@media (max-width: 768px){
    header h1{font-size:2rem;}
    header p{font-size:1rem;}
    .reference-form{max-width:90%; padding:20px; margin:100px auto 40px;}
    .reference-card{width:90%; min-height:180px; padding:15px;}
    .reference-text img.icon{width:40px; height:40px;}
    .next-button{padding:8px 18px; top:8px; right:15px;}
}
@media (max-width: 480px){
    header h1{font-size:1.5rem;}
    .reference-form h2{font-size:1.4rem;}
    .reference-form input, .reference-form textarea, .reference-form button{font-size:0.95rem; padding:12px;}
    .reference-card{width:100%; min-height:160px; padding:12px;}
    .reference-text img.icon{width:35px; height:35px;}
    .next-button{padding:6px 14px; top:6px; right:12px;}
}
</style>
</head>

<body>

<header>
    <a href="../index.html" class="back-button">‚Üê P√°gina Inicial</a>
    <div style="text-align:center;">
        <h1></h1>
        <p></p>
    </div>
</header>

<!-- CONTADOR -->
<div id="totalReferencesCounter">Refer√™ncias: 0</div>

<section id="references">
    <div class="carousel">
        <div id="carouselInner" class="carousel-inner"></div>
    </div>
</section>

<section class="reference-form">
    <h2>üíéDeixe sua Refer√™ncia</h2>
    <form id="sendReference">
        <input type="text" name="fullname" placeholder="üìånome real" required>
        <input type="text" name="nickname" placeholder="üìånickname no jogo" required>
        <input type="email" name="email" placeholder="üíåE-mail v√°lido" required>
        <textarea name="message" rows="4" placeholder="üí¨Sua refer√™ncia..." required style="resize:none;"></textarea>
        <button type="submit">Enviar</button>
    </form>
    <p id="successMessage" style="display:none;">Obrigado! Sua refer√™ncia foi enviada com sucesso.</p>
    <p id="errorMessage" style="display:none;">Nome real, nickname ou e-mail j√° foi usado.</p>
</section>

<div class="whatsapp-button" onclick="toggleChat()">
<i class="fab fa-whatsapp"></i> WhatsApp
</div>

<div class="whatsapp-widget">
    <div class="whatsapp-header">
        WhatsApp
        <span onclick="toggleChat()">√ó</span>
    </div>
    <div class="whatsapp-body">
        <p>Ol√° üëã<br>Fale com nosso atendimento.</p>
        <a href="https://wa.me/5524999561861" target="_blank" class="whatsapp-start">
        Iniciar conversa
        </a>
    </div>
</div>

<footer>
    <p>Quer fazer parte dessa lista? <a href="https://api.whatsapp.com/send/?phone=5524999561861&text&type=phone_number&app_absent=0">Negocie Comigoüí¨</a></p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
    apiKey: "AIzaSyBGeptReBViZ9CQoJ2G18SmnaxbnvO3kDw",
    authDomain: "referenciasjogadores.firebaseapp.com",
    projectId: "referenciasjogadores",
    storageBucket: "referenciasjogadores.appspot.com",
    messagingSenderId: "431805442384",
    appId: "1:431805442384:web:7c0bb851dc6362a54ee455"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const form = document.getElementById('sendReference');
const successMessage = document.getElementById('successMessage');
const errorMessage = document.getElementById('errorMessage');
const carouselInner = document.getElementById('carouselInner');
const totalCounter = document.getElementById('totalReferencesCounter');

let references = [];
let currentIndex = 0;

function loadReferences() {
    db.collection("referencias").orderBy("timestamp","desc").get().then(qs => {
        references = [];
        qs.forEach(doc => references.push(doc.data()));
        showReference();
        updateTotalCounter();
    });
}

function showReference() {
    if(references.length > 0){
        const data = references[currentIndex];
        const card = document.createElement('div');
        card.classList.add('reference-card');
        card.innerHTML = `
            <div class="reference-text">
                <img class="icon" src="https://cdn3.emoji.gg/emojis/701524-neon-gmail-icon.png" alt="√çcone">
                <div>
                    <h4>${data.fullname}</h4>
                    <h3>${data.nickname}</h3>
                    <p>${data.message}</p>
                </div>
            </div>
            <button class="next-button" onclick="nextReference()">Pr√≥ximo</button>
        `;
        carouselInner.innerHTML='';
        carouselInner.appendChild(card);
    }else{
        carouselInner.innerHTML="<p>Nenhuma refer√™ncia dispon√≠vel.</p>";
    }
}

function nextReference(){ currentIndex=(currentIndex<references.length-1)?currentIndex+1:0; showReference(); }

function updateTotalCounter(){
    totalCounter.innerText = `Refer√™ncias: ${references.length}`;
}

form.addEventListener('submit', async e=>{
    e.preventDefault();
    const fullname=form.fullname.value.trim();
    const nickname=form.nickname.value.trim();
    const email=form.email.value.trim();
    const message=form.message.value.trim();

    try{
        const [emailSnap,nameSnap,nickSnap]=await Promise.all([
            db.collection("referencias").where("email","==",email).get(),
            db.collection("referencias").where("fullname","==",fullname).get(),
            db.collection("referencias").where("nickname","==",nickname).get()
        ]);

        if(!emailSnap.empty || !nameSnap.empty || !nickSnap.empty){
            errorMessage.style.display='block';
            successMessage.style.display='none';
            return;
        }

        await db.collection("referencias").add({ fullname, nickname, email, message, timestamp: firebase.firestore.FieldValue.serverTimestamp() });

        successMessage.style.display='block';
        errorMessage.style.display='none';
        setTimeout(()=>successMessage.style.display='none',4000);
        form.reset();
        loadReferences();

    }catch(err){ console.error("Erro ao enviar refer√™ncia:",err); }
});

loadReferences();

let lastScroll = 0;
const header = document.querySelector('header');
window.addEventListener('scroll',()=>{
  const currentScroll = window.pageYOffset;
  if(currentScroll>lastScroll && currentScroll>50){
    header.style.top='-120px';
  } else {
    header.style.top='0';
  }
  lastScroll=currentScroll;
});

function toggleChat(){
    const chat=document.querySelector('.whatsapp-widget');
    chat.style.display=chat.style.display==='block'?'none':'block';
}
</script>

</body>
</html>
